local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local function getHRP(timeout)
    timeout = timeout or 10
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local t = 0
    while not hrp and t < timeout do
        char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        hrp = char:FindFirstChild("HumanoidRootPart")
        task.wait(0.1); t += 0.1
    end
    return hrp
end

local function getCheckpoints()
    local folder = workspace:FindFirstChild("Checkpoints")
    local list = {}
    if folder then
        for _,obj in ipairs(folder:GetChildren()) do
            if obj:IsA("BasePart") then
                table.insert(list, obj)
            end
        end
    end
    table.sort(list, function(a,b) return a.Name < b.Name end)
    return list
end

local function getFinish()
    local folder = workspace:FindFirstChild("Finish")
    if folder then
        local f = folder:FindFirstChild("Finish")
        if f and f:IsA("BasePart") then
            return f
        end
    end
    return nil
end

local function triggerAndTeleport(hrp, part)
    if not (hrp and part) then return end
    local fti = rawget(getfenv() or _G, "firetouchinterest") or _G.firetouchinterest
    if typeof(fti) == "function" then
        pcall(function()
            fti(hrp, part, 0); task.wait(0.05); fti(hrp, part, 1)
        end)
    end
    hrp.CFrame = part.CFrame + Vector3.new(0, 3, 0)
    task.wait(0.1)
end

local running = false

local function runLoop()
    while running do
        local hrp = getHRP()
        if not hrp then return end

        local leaderstats = LocalPlayer:FindFirstChild("leaderstats")
        local summitStat = leaderstats and leaderstats:FindFirstChild("Summit")
        local beforeSummit = summitStat and summitStat.Value or 0

        local cps = getCheckpoints()
        for _,cp in ipairs(cps) do
            if not running then return end
            triggerAndTeleport(hrp, cp)
        end

        local fin = getFinish()
        if fin and running then
            triggerAndTeleport(hrp, fin)
        end

        if summitStat then
            local t = 0
            while running and summitStat.Value == beforeSummit and t < 5 do
                task.wait(0.2); t += 0.2
            end
            if running and summitStat.Value > beforeSummit then
                if LocalPlayer.Character then
                    LocalPlayer.Character:BreakJoints()
                end
            end
        end

        task.wait(0.5)
    end
end

local gui = Instance.new("ScreenGui")
gui.Name = "TPFarmGUI"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = game.CoreGui

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromOffset(240, 90)
frame.Position = UDim2.new(0.5, -120, 0, 60)
frame.BackgroundColor3 = Color3.fromRGB(20,20,22)
frame.BackgroundTransparency = 0.2
frame.Active, frame.Draggable = true, true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,12)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, -12, 0, 26)
title.Position = UDim2.new(0, 12, 0, 8)
title.BackgroundTransparency = 1
title.Text = "VEET - Home"
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextColor3 = Color3.fromRGB(220,220,230)

local enableBtn = Instance.new("TextButton", frame)
enableBtn.Size = UDim2.fromOffset(120, 32)
enableBtn.Position = UDim2.new(0.5, -60, 0, 50)
enableBtn.BackgroundColor3 = Color3.fromRGB(34,34,40)
enableBtn.Text = "ENABLE: OFF"
enableBtn.Font = Enum.Font.GothamMedium
enableBtn.TextSize = 14
enableBtn.TextColor3 = Color3.fromRGB(230,230,235)
Instance.new("UICorner", enableBtn).CornerRadius = UDim.new(0,10)

enableBtn.MouseButton1Click:Connect(function()
    running = not running
    enableBtn.Text = "ENABLE: " .. (running and "ON" or "OFF")
    if running then
        task.spawn(runLoop)
    end
end)